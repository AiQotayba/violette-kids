generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model Content {
  id           Int               @id @default(autoincrement())
  title        String
  description  String?
  type         ContentType
  ageMin       Int
  ageMax       Int
  thumbnailUrl String?
  contentUrl   String?
  fileUrl      String?
  sourceType   ContentSourceType
  isActive     Boolean           @default(true)
  orderIndex   Int               @default(0)
  createdAt    DateTime          @default(now())
  ageGroups    ContentAgeGroup[]
  categories   ContentCategory[]
  pages        ContentPage[]
}

model ContentPage {
  id         Int     @id @default(autoincrement())
  contentId  Int
  pageNumber Int
  imageUrl   String
  text       String?
  content    Content @relation(fields: [contentId], references: [id], onDelete: Cascade)

  @@unique([contentId, pageNumber])
}

model Category {
  id       Int               @id @default(autoincrement())
  name     String            @unique
  icon     String?
  contents ContentCategory[]
}

model ContentCategory {
  contentId  Int
  categoryId Int
  category   Category @relation(fields: [categoryId], references: [id], onDelete: Cascade)
  content    Content  @relation(fields: [contentId], references: [id], onDelete: Cascade)

  @@id([contentId, categoryId])
}

model AgeGroup {
  id       Int               @id @default(autoincrement())
  label    String            @unique
  ageMin   Int
  ageMax   Int
  contents ContentAgeGroup[]
}

model ContentAgeGroup {
  contentId  Int
  ageGroupId Int
  ageGroup   AgeGroup @relation(fields: [ageGroupId], references: [id], onDelete: Cascade)
  content    Content  @relation(fields: [contentId], references: [id], onDelete: Cascade)

  @@id([contentId, ageGroupId])
}

model Admin {
  id        Int      @id @default(autoincrement())
  name      String
  email     String   @unique
  password  String
  createdAt DateTime @default(now())
}

model AppSetting {
  id    Int    @id @default(autoincrement())
  key   String @unique
  value String
}

enum ContentType {
  story
  video
  game
}

enum ContentSourceType {
  uploaded
  youtube
  external
}
